#!/usr/bin/python3
import notaol.p3.client
import Extras.client_lib as cl

def get_response():
    response = sock.recv(8192)
    print(response)
#    complete_response = ''
#    while True:
#        response = sock.recv(8192)
#        if len(response) <= 0:
#            break
#        complete_response += str(response)
#    print(complete_response)

def connect():
    global sock
    sock = cl.connect()
    sock.send(cl.to_hex(cl.init_packet))
    get_response()
    #init_response = cl.receive_packet(sock)
    #print(init_response)
    sock.send(cl.to_hex(cl.login_packet))
    login_response = cl.receive_packet(sock)
    print(login_response)
    return sock

def aoshell():
    i = input("reAOL > ")
    if i == "quit":
        exit()
    elif i == "home":
        home_aoshell()
    elif i == "connect":
        # Connect with 2nd arg as username
        connect()
    elif i == "chat":
        join_chat()
    elif i == "commands":
        print_ascii_banner()
        print(
        '''
        pyAOL Client written for re-AOL

        General Commands:
        
        Connect as a Guest:
        reAOL > connect Guest

        Sign Off:
        reAOL > signoff

        List Chat Rooms:
        reAOL > chat list
        reAOL > chat join RoomName
        reAOL > chat leave

        Back to Home:
        reAOL > home

        Quit PyAOL:
        reAOL > quit
        '''
        )
    elif i == "signoff":
        signoff()
    else:
        for a in range(len(i)):
            print(i[a])
    while True:
        get_response()
    aoshell() 

def signoff():
    sock.send(cl.to_hex(cl.signoff_packet))
    signoff_response = cl.receive_packet(sock)
    print(signoff_response)

def join_chat():
    sock.send(cl.to_hex(cl.join_welcome))
    print(cl.receive_packet(sock))

def home_aoshell():
    print_ascii_banner()
    aoshell()

def print_ascii_banner():
    print(
    '''
             Welcome to:
    '                             d8888   .d88888b.   888
    '                            d88888d 888P"  "Y88b 888
    '                           d88P8888 888      888 888
    '888d888  .d88b.           d88P 8888 888      888 888
    '888 P " 8P  Y8b          d88P  8888 888      888 888
    '888     88888888 888888 d88P   8888 888      888 888
    '888     Y8b.            d8888888888  Y88b. .d88P 888
    '888      "Y8888        d88P     888   "Y88888P"  88888888
                                            generated by: syg

    For more information please visit:       http://reaol.org
    Discord Chat available at:        http://discord.gg/reaol

    Please enter a command at the prompt to begin.
    For a list of commands enter:     commands
    '''
    )
    
if __name__ == "__main__":
    print_ascii_banner()
    aoshell()
